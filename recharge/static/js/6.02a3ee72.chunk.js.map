{"version":3,"sources":["pages/RechargeRecords/index.js"],"names":["connect","address","stop","blackHole","getIdentity","useState","list","setList","loading","setLoading","loadingReturn","setLoadingReturn","getList","orders","then","data","ret","useEffect","className","map","action","createtime","dos","btc","status","repent","id","onClick","toast","window","demos","transfer","transactionHash","returnRecharge","rawtx","err","toString","returnDOS","time","t","Date","year","getFullYear","month","getMonth","date","getDate","addZero","formatTime"],"mappings":"+LA+HeA,yBAxHf,YAAmE,IAAzCC,EAAwC,EAAxCA,QAASC,EAA+B,EAA/BA,KAAMC,EAAyB,EAAzBA,UAAWC,EAAc,EAAdA,YAAc,EACtCC,mBAAS,IAD6B,mBACvDC,EADuD,KACjDC,EADiD,OAEhCF,oBAAS,GAFuB,mBAEvDG,EAFuD,KAE9CC,EAF8C,OAGpBJ,oBAAS,GAHW,mBAGvDK,EAHuD,KAGxCC,EAHwC,KAS9D,SAASC,IACAX,IACLQ,GAAW,GACXI,YAAO,CAACZ,YAAUa,MAAK,YAAa,IAAXC,EAAU,EAAVA,KACjBA,EAAKC,KACLT,EAAQQ,EAAKA,KAAKT,MAEtBG,GAAW,MACZ,WACCA,GAAW,OAkDnB,OA/DAQ,qBAAU,WACNL,MACD,CAACX,IA8DA,yBAAKiB,UAAU,YACX,yBAAKA,UAAU,UACX,6BACI,uBAAGA,UAAU,MAAb,oDACA,uBAAGA,UAAU,MAAMhB,EAAO,IAA1B,IAA+B,qCAGvC,wBAAIgB,UAAU,QACV,4BACI,6CACA,oCACA,oCACA,sCAEHZ,EAAKa,KAAI,YAAiD,IACnDC,EADIC,EAA8C,EAA9CA,WAAYC,EAAkC,EAAlCA,IAAKC,EAA6B,EAA7BA,IAAKC,EAAwB,EAAxBA,OAAQC,EAAgB,EAAhBA,OAAQC,EAAQ,EAARA,GAE9C,GAAGD,EACCL,EAAS,0BAET,OAAQI,GACJ,KAAK,EACDJ,EAAS,qBACT,MACJ,KAAK,EAIDA,EAAS,4BAAQO,QAHjB,YA7D5B,SAAoBD,EAAIJ,GACfnB,EAKFO,EACCkB,YAAM,8CAIVC,OAAOC,MAAMC,SAAS5B,EAAWmB,EAAI,KAAKR,MAAK,YAA8B,IAAnBkB,EAAkB,EAAlBA,gBAClDA,GACArB,GAAiB,GACjBsB,YAAe,CAAChC,UAASyB,KAAIQ,MAAOF,IAAkBlB,MAAK,YAAmB,IAARC,EAAO,EAAPA,KAClEJ,GAAiB,GACdI,EAAKC,KACJY,YAAM,4BACNhB,IACAR,EAAYH,IAEZ2B,YAAMb,EAAKA,SAGhB,SAAUoB,GACTxB,GAAiB,GACjBiB,YAAMO,EAAIC,gBAGdR,YAAM,+CAEX,SAAUO,GACTP,YAAMO,EAAIC,eA9BVR,YAAM,0DA4DkBS,CAAUX,EAAIJ,KAET,gBACT,MACJ,KAAK,EACDF,EAAS,eACT,MACJ,QACIA,EAAM,iBAAaI,GAG/B,OACI,4BACI,6BArFxB,SAAqBc,GACjB,IAAMC,EAAI,IAAIC,KAAU,IAALF,GACbG,EAAOF,EAAEG,cACTC,EAAQJ,EAAEK,WAAa,EACvBC,EAAON,EAAEO,UAEf,MAAM,GAAN,OAAUL,EAAV,YAAkBM,YAAQJ,GAA1B,YAAoCI,YAAQF,IA+ElBG,CAAW3B,IACjB,6BAAMC,EAAM,KACZ,6BAAMC,EAAM,KACZ,6BAAMH,OAIjBZ,GAAW,kBAAC,IAAD","file":"static/js/6.02a3ee72.chunk.js","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport {Loading} from '../../components';\nimport './style.scss';\nimport {toast, addZero} from \"../../utils\";\nimport {orders, returnRecharge} from \"../../service\";\nimport {connect} from \"../../components\"\n\nfunction RechargeRecords({address, stop, blackHole, getIdentity}) {\n    const [list, setList] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [loadingReturn, setLoadingReturn] = useState(false);\n\n    useEffect(() => {\n        getList();\n    }, [address]);\n\n    function getList () {\n        if (!address) return;\n        setLoading(true);\n        orders({address}).then(({data}) => {\n            if (data.ret) {\n                setList(data.data.list);\n            }\n            setLoading(false);\n        }, () => {\n            setLoading(false);\n        });\n    }\n\n    function formatTime (time) {\n        const t = new Date(time*1000);\n        const year = t.getFullYear();\n        const month = t.getMonth() + 1;\n        const date = t.getDate();\n\n        return `${year}-${addZero(month)}-${addZero(date)}`;\n\n    }\n\n    function returnDOS (id, dos) {\n        if (!blackHole) {\n            toast('数据获取中，请稍后');\n            return\n        }\n\n        if(loadingReturn){\n            toast('回退中，请稍后');\n            return\n        }\n\n        window.demos.transfer(blackHole, dos/1e8).then(function ({transactionHash}) {\n            if (transactionHash) {\n                setLoadingReturn(true);\n                returnRecharge({address, id, rawtx: transactionHash}).then(function ({data}) {\n                    setLoadingReturn(false);\n                    if(data.ret) {\n                        toast('回退成功');\n                        getList();\n                        getIdentity(address);\n                    } else {\n                        toast(data.data);\n                    }\n\n                }, function (err) {\n                    setLoadingReturn(false);\n                    toast(err.toString())\n                })\n            } else {\n                toast('获取交易hash失败')\n            }\n        }, function (err) {\n            toast(err.toString())\n        })\n    }\n\n    return (\n        <div className='p-return'>\n            <div className='circle'>\n                <div>\n                    <p className='p1'>距离停盘发放还剩</p>\n                    <p className='p2'>{stop / 1e8} <i>DOS</i></p>\n                </div>\n            </div>\n            <ul className='list'>\n                <li>\n                    <div>日期</div>\n                    <div>DOS</div>\n                    <div>BTC</div>\n                    <div>&nbsp;</div>\n                </li>\n                {list.map(({createtime, dos, btc, status, repent, id}) => {\n                    let action;\n                    if(repent) {\n                        action = '已回退';\n                    } else {\n                        switch (status) {\n                            case 0:\n                                action = '未到账';\n                                break;\n                            case 1:\n                                function handleClick () {\n                                    returnDOS(id, dos);\n                                }\n                                action = <button onClick={handleClick}>回退</button>;\n                                break;\n                            case 2:\n                                action = '异常';\n                                break;\n                            default:\n                                action = `status:${status}`;\n                        }\n                    }\n                    return (\n                        <li>\n                            <div>{formatTime(createtime)}</div>\n                            <div>{dos / 1e8}</div>\n                            <div>{btc / 1e8}</div>\n                            <div>{action}</div>\n                        </li>\n                    )\n                })}\n                {loading && <Loading /> }\n            </ul>\n        </div>\n    )\n}\n\nexport default connect()(RechargeRecords);\n"],"sourceRoot":""}