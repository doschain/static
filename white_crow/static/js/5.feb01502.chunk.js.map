{"version":3,"sources":["service/index.js","pages/Home/index.js"],"names":["hosts","window","location","host","getUser","address","demos","request","method","url","bindCode","code","data","activeUser","rawtx","getMatrixList","addr","type","doBuyMatrix","id","root","document","getElementById","timer","connect","t","history","invite","parseQuery","getQuery","useState","QRC","setQRC","top","setTop","state","setState","showShare","setShowShare","showRecommend","setShowRecommend","showCheckHash","setShowCheckHash","isLoading","setIsLoading","recommend","setRecommend","hash","setHash","handleCloseShare","preventTouchStart","banner","width","body","clientWidth","height","clientHeight","initQRCode","a","QRCode","toDataURL","origin","margin","console","error","initState","then","log","user","validateTrade","sessionStorage","JSON","stringify","qoute","showError","err","warn","check","dosdata","chain","transaction","confirmations","clearTimeout","setTimeout","errMsg","contractRaw","value","price","catch","toast","toString","_active","useEffect","addEventListener","removeEventListener","className","style","num","num24h","value24h","value3x","value4x","onClick","push","disabled","visible","onCancel","src","alt","select","execCommand","e","readOnly","border","padding","position","left","onChange","showClose","placeholder","ev","target","scanQRCode","includes","match","trim","_"],"mappings":"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","file":"static/js/5.feb01502.chunk.js","sourcesContent":["// import {axios} from '../utils'\n// import {toast} from \"../utils\"\nlet hosts = \"http://proxy-mainnet.doschain.org/insight\";\n// let hosts2 = \"http://mainnet.doschain.org/insight\";\nif (window.location.host !== \"games.doschain.org\") {\n  hosts = \"http://35.220.198.141:8087\";\n  // hosts = \"http://10.0.0.15:8083\";\n  // hosts2 = \"https://testnet.doschain.org/insight\";\n}\n\nasync function requestWrapper(request) {\n  return new Promise(async (resolve, reject) => {\n    try {\n      var res = await request;\n      resolve(JSON.parse(res));\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n/** 用户信息 **/\nexport const getUser = (address) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/user/${address}`,\n  });\n};\n\n/** 绑定 **/\nexport const bindCode = (address, code) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/bind`,\n    data: { code },\n  });\n};\n\n/** 激活 **/\nexport const activeUser = (address, rawtx) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/active`,\n    data: { rawtx },\n  });\n};\n\n/** 示例 **/\nexport const requestExample = (price, num, code) => {\n  return requestWrapper(window.demos.allin.submit(price, num - 0, code, \"\"));\n};\n\n/** 矩阵列表 **/\nexport const getMatrixList = ({ addr, type = 0 }) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/matrix/${addr}/${type}`,\n  });\n};\n\n/** 购买矩阵 **/\nexport const doBuyMatrix = ({ id, addr, type }) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/matrix/${addr}/${type}/${id}/pay`,\n  });\n};\n","import React, { useEffect, useState } from \"react\";\nimport \"./style.scss\";\nimport { connect, MaskLoading, Card, CheckHashModal, Modal, LanguageSwitch } from \"../../components\";\n// import {HashRouter as Router, Link} from \"react-router-dom\";\nimport { toast, parseQuery, showError/*, addZero*/ } from \"../../utils\";\nimport { getUser, bindCode, activeUser as _active } from \"../../service\"\nimport QRCode from 'qrcode';\nlet root = document.getElementById( 'root' );\nlet timer = null;\n\nfunction Home({ address, t, history}) {\n  const invite = parseQuery.getQuery('invite') || '';\n  const [QRC, setQRC] = useState('');\n  const [top, setTop] = useState(null);\n  const [state, setState] = useState(null);\n  const [showShare, setShowShare] = useState(false);\n  const [showRecommend, setShowRecommend] = useState(false);\n  const [showCheckHash, setShowCheckHash] = useState(false);\n  const [isLoading, setIsLoading] = useState(false); //开通loading\n  const [recommend, setRecommend] = useState(invite); //推荐地址\n  const [hash, setHash] = useState(''); //激活hash\n\n  function handleOpenShare(){\n    setShowShare(true);\n  }\n\n  function handleCloseShare(){\n    setShowShare(false);\n  }\n\n  function preventTouchStart() {\n    let banner = document.getElementById('home-banner');\n    let width = document.body.clientWidth;\n    let height = banner.clientHeight - 705 * (width / 750) ;\n    setTop(height  + 'px');\n  }\n\n  useEffect(() => {\n    root.addEventListener( 'touchstart', preventTouchStart , false );\n    if (!address) return;\n    initState();\n    return () => {\n      root.removeEventListener('touchstart', preventTouchStart);\n    };\n  }, [address]);\n\n  function copyAddress () {\n    try {\n      const input = document.getElementById('address-container');\n      input.select();\n      document.execCommand('Copy');\n      toast(t('copy_success'));\n      handleCloseShare();\n    } catch (e) {\n      toast(t('copy_failed'));\n    }\n  }\n\n  function handleChangeRecommend(ev){\n    setRecommend(ev.target.value);\n  }\n\n  async function initQRCode(code) {\n    let location = window.location;\n    try {\n      const QRC = await QRCode.toDataURL(`${location.origin}/?orientation=portrait&invite=${code}`, { width: 350, margin: 0 });\n      setQRC(QRC);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function initState() {\n    setIsLoading(true);\n    getUser(address).then(async (data) => {\n      console.log(data);\n      setIsLoading(false);\n      if (data.code === 200) {\n        setState(data.data);\n        let user = data.data.user;\n        let state = data.data.state;\n        if (user.hash && user.state === 0) {\n          setHash(user.hash);\n          validateTrade(user.hash);\n        }\n        if(user.state === 1){\n          window.sessionStorage[`white_crow_${address}`] = JSON.stringify({\n            address: state.address,\n            qoute: state.qoute,\n            hash: user.hash,\n          });\n        }\n        await initQRCode(user.code);\n      } else if(data.code === 1001)  {\n        setShowRecommend(true);\n      } else {\n        showError(data.code);\n      }\n    }, (err) => {\n      console.warn(err);\n      setIsLoading(false);\n    });\n  }\n\n  function scan () {\n    window.demos.scanQRCode().then(function (data){\n      let addr = data;\n      if(data.includes('invite=')) {\n        addr = data.match(/invite=(\\w+)/)[1]\n      }\n      setRecommend(addr);\n    });\n  }\n\n  function bind() {\n    if(!address) return;\n    let code = recommend.trim();\n\n    if (!code) {\n      toast('请填写推荐ID');\n      return;\n    }\n\n    setIsLoading(true);\n    bindCode(address, code).then(function (data) {\n      console.log(data);\n      setIsLoading(false);\n      if(data.code === 200) {\n        toast('绑定成功');\n        setShowRecommend(false);\n        initState();\n      } else {\n        showError(data.code, t);\n        // toast('绑定失败');\n      }\n    }, function (_) {\n      setIsLoading(false);\n    })\n  }\n\n  // 确认交易数\n  function validateTrade (hash) {\n    if (!hash) return;\n\n    try {\n      async function check () {\n        const { confirmations } = await window.demos.dosdata.chain.transaction(hash);\n        if (confirmations && confirmations > 1) {\n          clearTimeout(timer);\n          setHash('');\n          initState();\n        } else {\n          timer = setTimeout(check, 2000);\n        }\n      }\n      clearTimeout(timer);\n      timer = setTimeout(check, 2000);\n    } catch (errMsg) {\n      console.error(errMsg);\n    }\n  }\n\n  function checkHash () {\n    setShowCheckHash(true);\n  }\n\n  async function activeUser(){\n    let rawtx = await window.demos.contractRaw(\n        \"send\",\n        state.state.qoute,\n        [\n          {type:\"address\", value: state.state.address},\n          {type: \"uint256\", value: state.state.price * 2},\n        ]\n    ).catch(function (err) {\n      toast(err.toString());\n    });\n\n    if (!rawtx) {\n      toast('激活失败');\n      return;\n    }\n\n    // console.log(rawtx);\n    setIsLoading(true);\n    await _active(address, rawtx).then((data) => {\n      console.log(data);\n      if (data.code === 200){\n        toast('激活成功');\n        setHash(data.data);\n        validateTrade(data.data);\n      } else {\n        setIsLoading(false);\n        showError(data.code);\n      }\n    },()=>{\n      setIsLoading(false);\n      toast('激活失败');\n    });\n\n  }\n\n  function goMatrix() {\n    history.push('/matrix');\n  }\n\n  return (\n      <div className=\"p-home\">\n        <LanguageSwitch />\n        <div className='home-wrapper'>\n          {top !== null && <div className='home-banner-polyfill' style={{top: top}} />}\n          <div className=\"home-banner\" id='home-banner'>\n            <p>{t('white_crow')}</p>\n          </div>\n          {state && (\n              <Card>\n                <ul className='home-info clearFloat'>\n                  <li>\n                    <strong>{state.state.num}</strong>\n                    <p>{t('home_info1')}</p>\n                  </li>\n                  <li>\n                    <strong>+{state.state.num24h}</strong>\n                    <p>{t('home_info2')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value}</strong>\n                    <p>{t('home_info3')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value24h}</strong>\n                    <p>{t('home_info4')}</p>\n                  </li>\n                </ul>\n                <div className='home-info2'>\n                  <div>{state.user.value || '0.00'} DOS</div>\n                  <div>\n                    <div>ID {state.user.id}</div>\n                    <div>{state.user.num}</div>\n                  </div>\n                  <div><strong>X3</strong><span>{state.user.value3x || '0.00'} DOS</span></div>\n                  <div><strong>X4</strong><span>{state.user.value4x || '0.00'} DOS</span></div>\n                </div>\n              </Card>\n          )}\n\n          {state && (\n              <div className='home-bottom'>\n                <button onClick={handleOpenShare}>{t('share')}</button>\n                <div />\n                {state.user.state === 0\n                    ? <button onClick={hash ? checkHash : activeUser}>{t('active')}</button>\n                    : state.user.state === 1\n                        ? <button onClick={goMatrix}>{t('buy')}</button>\n                        : <button disabled>{t('user_disabled')}</button>\n                }\n              </div>\n          )}\n\n        </div>\n\n        {state && (\n            <Modal visible={showShare} onCancel={handleCloseShare} className='home-qrCode-modal'>\n              <p className='p1'>{t('affiliate_link')}</p>\n              <div className='home-qrCode'>\n                {QRC && <img src={QRC} alt=\"\" width=\"350\" height=\"350\" />}\n              </div>\n              <p className='p2'>{state.user.code}</p>\n              <button onClick={copyAddress}>{t('copy_address')}</button>\n              <input\n                  type=\"text\"\n                  value={state.user.code}\n                  readOnly\n                  id=\"address-container\"\n                  style={{ border: 0, padding: 0, position: 'fixed', left: '-100%' }}\n                  onChange={() => {}}\n              />\n            </Modal>\n        )}\n\n        <Modal visible={showRecommend} showClose={false} className='home-recommend-modal'>\n          <p className='p1'>{t('recommended_id')}</p>\n          <div className='home-input'>\n            <input\n                type=\"text\"\n                placeholder={t('recommended_hint')}\n                value={recommend}\n                onChange={handleChangeRecommend}\n            />\n            <div onClick={scan}/>\n          </div>\n          <button onClick={bind}>{t('submit')}</button>\n        </Modal>\n\n        <CheckHashModal\n            hash={hash}\n            visible={showCheckHash}\n            onCancel={() => {setShowCheckHash(false)}}\n        />\n\n        {isLoading && <MaskLoading />}\n      </div>\n  );\n}\n\nexport default connect()(Home);\n"],"sourceRoot":""}