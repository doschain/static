{"version":3,"sources":["service/index.js","pages/Home/index.js"],"names":["hosts","window","location","host","getUser","address","demos","request","method","url","bindCode","code","data","getMatrixList","type","root","document","getElementById","connect","t","history","invite","parseQuery","getQuery","useState","QRC","setQRC","top","setTop","state","setState","showShare","setShowShare","showRecommend","setShowRecommend","isLoading","setIsLoading","recommend","setRecommend","handleCloseShare","preventTouchStart","banner","width","body","clientWidth","height","clientHeight","initQRCode","a","QRCode","toDataURL","origin","margin","console","error","initState","then","log","user","showError","err","warn","useEffect","addEventListener","removeEventListener","className","style","id","num","num24h","value","value24h","value3x","value4x","onClick","toast","push","disabled","visible","onCancel","src","alt","select","execCommand","e","readOnly","border","padding","position","left","onChange","showClose","placeholder","ev","target","scanQRCode","addr","includes","match","trim","_"],"mappings":"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","file":"static/js/5.1b509ba3.chunk.js","sourcesContent":["// import {axios} from '../utils'\n// import {toast} from \"../utils\"\nlet hosts = \"http://proxy-mainnet.doschain.org/insight\";\n// let hosts2 = \"http://mainnet.doschain.org/insight\";\nif (window.location.host !== \"games.doschain.org\") {\n  hosts = \"http://35.220.198.141:8087\";\n  // hosts = \"http://10.0.0.15:8083\";\n  // hosts2 = \"https://testnet.doschain.org/insight\";\n}\n\nasync function requestWrapper(request) {\n  return new Promise(async (resolve, reject) => {\n    try {\n      var res = await request;\n      resolve(JSON.parse(res));\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n/** 用户信息 **/\nexport const getUser = (address) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/user/${address}`,\n  });\n};\n\n/** 绑定 **/\nexport const bindCode = (address, code) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/bind`,\n    data: { code },\n  });\n};\n\n/** 激活 **/\nexport const activeUser = (address, rawtx) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/active`,\n    data: { rawtx },\n  });\n};\n\n/** 示例 **/\nexport const requestExample = (price, num, code) => {\n  return requestWrapper(window.demos.allin.submit(price, num - 0, code, \"\"));\n};\n\n/** 举证列表 **/\nexport const getMatrixList = ({ address, type = 0 }) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/matrix/${address}/${type}`,\n  });\n};\n","import React, { useEffect, useState } from \"react\";\nimport \"./style.scss\";\nimport { connect, MaskLoading, Card, Loading, Modal, LanguageSwitch } from \"../../components\";\n// import {HashRouter as Router, Link} from \"react-router-dom\";\nimport { toast, parseQuery, showError/*, addZero*/ } from \"../../utils\";\nimport { getUser, bindCode, activeUser as _active } from \"../../service\"\nimport QRCode from 'qrcode';\nlet root = document.getElementById( 'root' );\n\nfunction Home({ address, t, history}) {\n  const invite = parseQuery.getQuery('invite') || '';\n  const [QRC, setQRC] = useState('');\n  const [top, setTop] = useState(null);\n  const [state, setState] = useState(null);\n  const [showShare, setShowShare] = useState(false);\n  const [showRecommend, setShowRecommend] = useState(false);\n  const [isLoading, setIsLoading] = useState(false); //开通loading\n  const [recommend, setRecommend] = useState(invite); //推荐地址\n\n  function handleOpenShare(){\n    setShowShare(true);\n  }\n\n  function handleCloseShare(){\n    setShowShare(false);\n  }\n\n  function preventTouchStart() {\n    let banner = document.getElementById('home-banner');\n    let width = document.body.clientWidth;\n    let height = banner.clientHeight - 705 * (width / 750) ;\n    setTop(height  + 'px');\n  }\n\n  useEffect(() => {\n    root.addEventListener( 'touchstart', preventTouchStart , false );\n    if (!address) return;\n    initState();\n    return () => {\n      root.removeEventListener('touchmove', preventTouchStart);\n    };\n  }, [address]);\n\n  function copyAddress () {\n    try {\n      const input = document.getElementById('address-container');\n      input.select();\n      document.execCommand('Copy');\n      toast(t('copy_success'));\n      handleCloseShare();\n    } catch (e) {\n      toast(t('copy_failed'));\n    }\n  }\n\n  function handleChangeRecommend(ev){\n    setRecommend(ev.target.value);\n  }\n\n  async function initQRCode(code) {\n    let location = window.location;\n    try {\n      const QRC = await QRCode.toDataURL(`${location.origin}/?orientation=portrait&invite=${code}`, { width: 350, margin: 0 });\n      setQRC(QRC);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function initState() {\n    setIsLoading(true);\n    getUser(address).then(async (data) => {\n      console.log(data);\n      setIsLoading(false);\n      if (data.code === 200) {\n        setState(data.data);\n        await initQRCode(data.data.user.code);\n      } else if(data.code === 1001)  {\n        setShowRecommend(true);\n      } else {\n        showError(data.code);\n      }\n    }, (err) => {\n      console.warn(err);\n      setIsLoading(false);\n    });\n  }\n\n  function scan () {\n    window.demos.scanQRCode().then(function (data){\n      let addr = data;\n      if(data.includes('invite=')) {\n        addr = data.match(/invite=(\\w+)/)[1]\n      }\n      setRecommend(addr);\n    });\n  }\n\n  function bind() {\n    if(!address) return;\n    let code = recommend.trim();\n\n    if (!code) {\n      toast('请填写推荐ID');\n      return;\n    }\n\n    setIsLoading(true);\n    bindCode(address, code).then(function (data) {\n      console.log(data);\n      setIsLoading(false);\n      if(data.code === 200) {\n        toast('绑定成功');\n        setShowRecommend(false);\n        initState();\n      } else {\n        showError(data.code, t);\n        // toast('绑定失败');\n      }\n    }, function (_) {\n      setIsLoading(false);\n    })\n  }\n\n  function activeUser(){\n    toast('activeUser');\n    // _active(address, 100)\n    // window.demos.contract(\"pay\", btcLight, [{type: \"uint256\", value: certPrice}, {type:\"string\", value: \"[2]\"}]).then(function (data){\n    //   console.log(data);\n    //   setIsLoading(true);\n    //   _active(address, data).then(() => {\n    //     setIsLoading(false);\n    //   }, ()=>{\n    //     setIsLoading(false);\n    //   })\n    // }, function (err) {\n    //   toast(err.toString());\n    // });\n  }\n\n  function goMatrix() {\n    history.push('/matrix');\n  }\n\n  return (\n      <div className=\"p-home\">\n        <LanguageSwitch />\n        <div className='home-wrapper'>\n          {top !== null && <div className='home-banner-polyfill' style={{top: top}} />}\n          <div className=\"home-banner\" id='home-banner'>\n            <p>{t('white_crow')}</p>\n          </div>\n          {state && (\n              <Card>\n                <ul className='home-info clearFloat'>\n                  <li>\n                    <strong>{state.state.num}</strong>\n                    <p>{t('home_info1')}</p>\n                  </li>\n                  <li>\n                    <strong>+{state.state.num24h}</strong>\n                    <p>{t('home_info2')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value}</strong>\n                    <p>{t('home_info3')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value24h}</strong>\n                    <p>{t('home_info4')}</p>\n                  </li>\n                </ul>\n                <div className='home-info2'>\n                  <div>{state.user.value || '0.00'} DOS</div>\n                  <div>\n                    <div>ID {state.user.id}</div>\n                    <div>{state.user.num}</div>\n                  </div>\n                  <div><strong>X3</strong><span>{state.user.value3x || '0.00'} DOS</span></div>\n                  <div><strong>X4</strong><span>{state.user.value4x || '0.00'} DOS</span></div>\n                </div>\n              </Card>\n          )}\n\n          {state && (\n              <div className='home-bottom'>\n                <button onClick={handleOpenShare}>{t('share')}</button>\n                {state.user.state === 0\n                    ? <button onClick={activeUser}>{t('active')}</button>\n                    : state.user.state === 1\n                        ? <button onClick={goMatrix}>{t('buy')}</button>\n                        : <button disabled>{t('user_disabled')}</button>\n                }\n              </div>\n          )}\n\n        </div>\n\n        {state && (\n            <Modal visible={showShare} onCancel={handleCloseShare} className='home-qrCode-modal'>\n              <p className='p1'>{t('affiliate_link')}</p>\n              <div className='home-qrCode'>\n                {QRC && <img src={QRC} alt=\"\" width=\"350\" height=\"350\" />}\n              </div>\n              <p className='p2'>{state.user.code}</p>\n              <button onClick={copyAddress}>{t('copy_address')}</button>\n              <input\n                  type=\"text\"\n                  value={state.user.code}\n                  readOnly\n                  id=\"address-container\"\n                  style={{ border: 0, padding: 0, position: 'fixed', left: '-100%' }}\n                  onChange={() => {}}\n              />\n            </Modal>\n        )}\n\n        <Modal visible={showRecommend} showClose={false} className='home-recommend-modal'>\n          <p className='p1'>{t('recommended_id')}</p>\n          <div className='home-input'>\n            <input\n                type=\"text\"\n                placeholder={t('recommended_hint')}\n                value={recommend}\n                onChange={handleChangeRecommend}\n            />\n            <div onClick={scan}/>\n          </div>\n          <button onClick={bind}>{t('submit')}</button>\n        </Modal>\n\n        {isLoading && <MaskLoading />}\n      </div>\n  );\n}\n\nexport default connect()(Home);\n"],"sourceRoot":""}