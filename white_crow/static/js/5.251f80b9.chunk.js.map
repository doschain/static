{"version":3,"sources":["service/index.js","pages/Home/index.js"],"names":["hosts","window","location","host","getUser","address","demos","request","method","url","bindCode","code","data","activeUser","rawtx","getMatrixList","addr","type","doBuyMatrix","id","timer","document","getElementById","connect","t","history","invite","parseQuery","getQuery","useState","QRC","setQRC","top","setTop","state","setState","showShare","setShowShare","showRecommend","setShowRecommend","showCheckHash","setShowCheckHash","isLoading","setIsLoading","recommend","setRecommend","hash","setHash","handleCloseShare","initQRCode","a","QRCode","toDataURL","origin","width","margin","console","error","initState","then","log","user","validateTrade","sessionStorage","JSON","stringify","price","qoute","showError","err","warn","check","dosdata","expand","transaction","confirmations","clearTimeout","setTimeout","errMsg","contractRaw","value","catch","toast","toString","_active","useEffect","banner","body","clientWidth","height","clientHeight","preventTouchStart","className","style","num","num24h","value24h","value3x","value4x","onClick","push","disabled","visible","onCancel","src","alt","select","execCommand","e","readOnly","border","padding","position","left","onChange","showClose","placeholder","ev","target","scanQRCode","includes","match","trim","_"],"mappings":"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","file":"static/js/5.251f80b9.chunk.js","sourcesContent":["// import {axios} from '../utils'\n// import {toast} from \"../utils\"\nlet hosts = \"http://proxy-mainnet.doschain.org/insight\";\n// let hosts2 = \"http://mainnet.doschain.org/insight\";\nif (window.location.host !== \"games.doschain.org\") {\n  hosts = \"http://35.220.198.141:8087\";\n  // hosts = \"http://10.0.0.15:8083\";\n  // hosts2 = \"https://testnet.doschain.org/insight\";\n}\n\nasync function requestWrapper(request) {\n  return new Promise(async (resolve, reject) => {\n    try {\n      var res = await request;\n      resolve(JSON.parse(res));\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n/** 用户信息 **/\nexport const getUser = (address) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/user/${address}`,\n  });\n};\n\n/** 绑定 **/\nexport const bindCode = (address, code) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/bind`,\n    data: { code },\n  });\n};\n\n/** 激活 **/\nexport const activeUser = (address, rawtx) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/user/${address}/active`,\n    data: { rawtx },\n  });\n};\n\n/** 示例 **/\nexport const requestExample = (price, num, code) => {\n  return requestWrapper(window.demos.allin.submit(price, num - 0, code, \"\"));\n};\n\n/** 矩阵列表 **/\nexport const getMatrixList = ({ addr, type = 0 }) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/matrix/${addr}/${type}`,\n  });\n};\n\n/** 购买矩阵 **/\nexport const doBuyMatrix = ({ id, addr, type }) => {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/matrix/${addr}/${type}/${id}/pay`,\n  });\n};\n","import React, { useEffect, useState } from \"react\";\nimport \"./style.scss\";\nimport { connect, MaskLoading, Card, CheckHashModal, Modal, LanguageSwitch } from \"../../components\";\n// import {HashRouter as Router, Link} from \"react-router-dom\";\nimport { toast, parseQuery, showError/*, addZero*/ } from \"../../utils\";\nimport { getUser, bindCode, activeUser as _active } from \"../../service\"\nimport QRCode from 'qrcode';\nlet root = document.getElementById( 'root' );\nlet timer = null;\n\nfunction Home({ address, t, history}) {\n  const invite = parseQuery.getQuery('invite') || '';\n  const [QRC, setQRC] = useState('');\n  const [top, setTop] = useState(null);\n  const [state, setState] = useState(null);\n  const [showShare, setShowShare] = useState(false);\n  const [showRecommend, setShowRecommend] = useState(false);\n  const [showCheckHash, setShowCheckHash] = useState(false);\n  const [isLoading, setIsLoading] = useState(false); //开通loading\n  const [recommend, setRecommend] = useState(invite); //推荐地址\n  const [hash, setHash] = useState(''); //激活hash\n\n  function handleOpenShare(){\n    setShowShare(true);\n  }\n\n  function handleCloseShare(){\n    setShowShare(false);\n  }\n\n  function preventTouchStart() {\n    let banner = document.getElementById('home-banner');\n    let width = document.body.clientWidth;\n    let height = banner.clientHeight - 705 * (width / 750) ;\n    setTop(height  + 'px');\n  }\n\n  useEffect(() => {\n    preventTouchStart();\n    // root.addEventListener( 'touchstart', preventTouchStart , false );\n    if (!address) return;\n    initState();\n    // return () => {\n    //   root.removeEventListener('touchstart', preventTouchStart);\n    // };\n  }, [address]);\n\n  function copyAddress () {\n    try {\n      const input = document.getElementById('address-container');\n      input.select();\n      document.execCommand('Copy');\n      toast(t('copy_success'));\n      handleCloseShare();\n    } catch (e) {\n      toast(t('copy_failed'));\n    }\n  }\n\n  function handleChangeRecommend(ev){\n    setRecommend(ev.target.value);\n  }\n\n  async function initQRCode(code) {\n    let location = window.location;\n    try {\n      const QRC = await QRCode.toDataURL(`${location.origin}/?orientation=portrait&invite=${code}`, { width: 350, margin: 0 });\n      setQRC(QRC);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  function initState() {\n    setIsLoading(true);\n    getUser(address).then(async (data) => {\n      console.log(data);\n      setIsLoading(false);\n      if (data.code === 200) {\n        setState(data.data);\n        let user = data.data.user;\n        let state = data.data.state;\n        if (user.hash && user.state === 0) {\n          setHash(user.hash);\n          validateTrade(user.hash);\n        }\n        if(user.state === 1){\n          window.sessionStorage[`white_crow_${address}`] = JSON.stringify({\n            price: state.price,\n            address: state.address,\n            qoute: state.qoute,\n          });\n        }\n        await initQRCode(user.code);\n      } else if(data.code === 1001)  {\n        setShowRecommend(true);\n      } else {\n        showError(data.code);\n      }\n    }, (err) => {\n      console.warn(err);\n      setIsLoading(false);\n    });\n  }\n\n  function scan () {\n    window.demos.scanQRCode().then(function (data){\n      let addr = data;\n      if(data.includes('invite=')) {\n        addr = data.match(/invite=(\\w+)/)[1]\n      }\n      setRecommend(addr);\n    });\n  }\n\n  function bind() {\n    if(!address) return;\n    let code = recommend.trim();\n\n    if (!code) {\n      toast('请填写推荐ID');\n      return;\n    }\n\n    setIsLoading(true);\n    bindCode(address, code).then(function (data) {\n      console.log(data);\n      setIsLoading(false);\n      if(data.code === 200) {\n        toast('绑定成功');\n        setShowRecommend(false);\n        initState();\n      } else {\n        showError(data.code, t);\n        // toast('绑定失败');\n      }\n    }, function (_) {\n      setIsLoading(false);\n    })\n  }\n\n  // 确认交易数\n  function validateTrade (hash) {\n    if (!hash) return;\n    try {\n      async function check () {\n        console.log('demos.dosdata.expand.transaction');\n        const { confirmations } = await window.demos.dosdata.expand.transaction(hash);\n        console.log('confirmations: ' + confirmations);\n        if (confirmations && confirmations > 1) {\n          setHash('');\n          initState();\n        } else {\n          clearTimeout(timer);\n          timer = setTimeout(check, 2000);\n        }\n      }\n      clearTimeout(timer);\n      timer = setTimeout(check, 2000);\n    } catch (errMsg) {\n      console.error(errMsg);\n    }\n  }\n\n  function checkHash () {\n    setShowCheckHash(true);\n  }\n\n  async function activeUser(){\n    let rawtx = await window.demos.contractRaw(\n        \"send\",\n        state.state.qoute,\n        [\n          {type:\"address\", value: state.state.address},\n          {type: \"uint256\", value: state.state.price * 2},\n        ]\n    ).catch(function (err) {\n      toast(err.toString());\n    });\n\n    if (!rawtx) {\n      toast('激活失败');\n      return;\n    }\n\n    setIsLoading(true);\n    await _active(address, rawtx).then((data) => {\n      console.log(data);\n      setIsLoading(false);\n      if (data.code === 200){\n        toast('激活成功');\n        setHash(data.data);\n        validateTrade(data.data);\n      } else {\n        showError(data.code);\n      }\n    },()=>{\n      setIsLoading(false);\n      toast('激活失败');\n    });\n\n  }\n\n  function goMatrix() {\n    history.push('/matrix');\n  }\n\n  return (\n      <div className=\"p-home\">\n        <LanguageSwitch />\n        <div className='home-wrapper'>\n          {top !== null && <div className='home-banner-polyfill' style={{top: top}} />}\n          <div className=\"home-banner\" id='home-banner'>\n            <p>{t('white_crow')}</p>\n          </div>\n          {state && (\n              <Card>\n                <ul className='home-info clearFloat'>\n                  <li>\n                    <strong>{state.state.num}</strong>\n                    <p>{t('home_info1')}</p>\n                  </li>\n                  <li>\n                    <strong>+{state.state.num24h}</strong>\n                    <p>{t('home_info2')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value}</strong>\n                    <p>{t('home_info3')}</p>\n                  </li>\n                  <li>\n                    <strong>{state.state.value24h}</strong>\n                    <p>{t('home_info4')}</p>\n                  </li>\n                </ul>\n                <div className='home-info2'>\n                  <div>{state.user.value || '0.00'} DOS</div>\n                  <div>\n                    <div>ID {state.user.id}</div>\n                    <div>{state.user.num}</div>\n                  </div>\n                  <div><strong>X3</strong><span>{state.user.value3x || '0.00'} DOS</span></div>\n                  <div><strong>X4</strong><span>{state.user.value4x || '0.00'} DOS</span></div>\n                </div>\n              </Card>\n          )}\n\n          {state && (\n              <div className='home-bottom'>\n                <button onClick={handleOpenShare}>{t('share')}</button>\n                <div />\n                {state.user.state === 0\n                    ? <button onClick={hash ? checkHash : activeUser}>{t('active')}</button>\n                    : state.user.state === 1\n                        ? <button onClick={goMatrix}>{t('buy')}</button>\n                        : <button disabled>{t('user_disabled')}</button>\n                }\n              </div>\n          )}\n\n        </div>\n\n        {state && (\n            <Modal visible={showShare} onCancel={handleCloseShare} className='home-qrCode-modal'>\n              <p className='p1'>{t('affiliate_link')}</p>\n              <div className='home-qrCode'>\n                {QRC && <img src={QRC} alt=\"\" width=\"350\" height=\"350\" />}\n              </div>\n              <p className='p2'>{state.user.code}</p>\n              <button onClick={copyAddress}>{t('copy_address')}</button>\n              <input\n                  type=\"text\"\n                  value={state.user.code}\n                  readOnly\n                  id=\"address-container\"\n                  style={{ border: 0, padding: 0, position: 'fixed', left: '-100%' }}\n                  onChange={() => {}}\n              />\n            </Modal>\n        )}\n\n        <Modal visible={showRecommend} showClose={false} className='home-recommend-modal'>\n          <p className='p1'>{t('recommended_id')}</p>\n          <div className='home-input'>\n            <input\n                type=\"text\"\n                placeholder={t('recommended_hint')}\n                value={recommend}\n                onChange={handleChangeRecommend}\n            />\n            <div onClick={scan}/>\n          </div>\n          <button onClick={bind}>{t('submit')}</button>\n        </Modal>\n\n        <CheckHashModal\n            hash={hash}\n            visible={showCheckHash}\n            onCancel={() => {setShowCheckHash(false)}}\n        />\n\n        {isLoading && <MaskLoading />}\n      </div>\n  );\n}\n\nexport default connect()(Home);\n"],"sourceRoot":""}