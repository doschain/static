{"version":3,"sources":["services/network.js","utils/basicURL.js","utils/axios.js","utils/parseQuery.js","utils/formatAddr.js","page/dappBuy/buy.module.scss","page/dappBuy/index.js"],"names":["hosts","getDappList","addr","state","page","limit","category","queryStr","window","demos","request","method","url","getCategorites","getDappDevInfo","getDappInfo","id","fetchBuyDapp","rawtx","gain","code","mail","data","location","host","getOrders","address","getOrdersDetails","imgSrc","process","instance","axios","create","baseURL","timeout","interceptors","response","use","res","status","success","ret","parseInt","handleResBody","fail","error","Promise","reject","config","headers","it","encodeURIComponent","substring","length","walletAddress","len","substr","module","exports","TimeCountDown","order_time","now_time","className","styles","text","time","now","formatAddr","FormItemInput","props","label","placeHolder","type","msg","onChange","e","placeholder","cx","show","BuyDapp","history","dapp_id","match","params","globalStore","useContext","GlobalContext","useState","formData","setFormData","formConfig","setConfig","dappInfo","setDappinfo","useEffect","a","console","log","fetch","validate","errMsg","forEach","item","_formConfig","map","submitHandler","lock","contractRaw","contract","value","target_address","price","catch","parseFloat","wallet_address","loading","hide","push","onchangeHandler","event","target","slice","index","findIndex","decodeAddress","validateAddress","test","validateMail","title","i","key","onClick"],"mappings":"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","file":"static/js/5.eab08f32.chunk.js","sourcesContent":["let hosts = \"http://proxy-mainnet.doschain.org/insight\";\n// let hosts2 = \"http://mainnet.doschain.org/insight\";\nif (window.location.host !== \"games.doschain.org\") {\n  hosts = \"http://35.220.198.141:8088\";\n  // hosts = \"http://10.0.0.11:8088\";\n  // hosts = \"http://10.0.0.15:8083\";\n  // hosts2 = \"https://testnet.doschain.org/insight\";\n}\n\n/**\n * @param {String} addr 钱包地址\n * @param {String} state 应用类别 0:待申购，1:已申购\n * @param {number} page 当前页码\n * @param {number} limit 一页显示的数量\n * @param {number} category 分类id\n * @description 首页请求dapp应用列表\n */\nexport function getDappList({ addr, state, page, limit, category }) {\n  let queryStr = `${hosts}/v1/api/apps/${addr}/${state}/?page=${page}&limit=${limit}`;\n  if (category) queryStr += `&category=${category}`;\n\n  return window.demos.request({\n    method: \"GET\",\n    url: queryStr,\n  });\n}\n\n/**\n *\n * @description 获取首页分类列表\n */\nexport function getCategorites() {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/category`,\n  });\n}\n\n/**\n *\n * @description 获取首页开发应用的信息\n */\nexport function getDappDevInfo() {\n  return window.demos.request({ method: \"GET\", url: `${hosts}/v1/api/state` });\n}\n\n/**\n *\n * @param {number} id 应用ID\n * @description 获取应用详情信息\n */\nexport function getDappInfo(id) {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/app/${id}`,\n  });\n}\n\n/**\n *\n * @param {String} addr 钱包地址\n * @param {String} raw  待广播交易哈希\n * @param {number} id   应用ID\n * @param {String} gain 收益地址\n * @param {String} code 邀请矿池地址 (非必填)\n * @param {String} mail 邮箱地址\n */\nexport function fetchBuyDapp({ addr, rawtx, id, gain, code, mail }) {\n  return window.demos.request({\n    method: \"POST\",\n    url: `${hosts}/v1/api/app/${addr}/pay`,\n    data: {\n      rawtx,\n      id,\n      gain,\n      code,\n      mail,\n    },\n  });\n}\n\n/**\n * @param {String} address 钱包地址\n * @description 获取订单记录\n */\nexport const getOrders = (address) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/orders/${address}`,\n  });\n};\n\n/**\n * @param {String} address 钱包地址\n * @param {String} id 订单id\n * @description 获取订单详情\n */\nexport const getOrdersDetails = (address, id) => {\n  return window.demos.request({\n    method: \"GET\",\n    url: `${hosts}/v1/api/order/${address}/${id}`,\n  });\n};\n","export default {\n  imgSrc: `${process.env.PUBLIC_URL}/images`,\n};\n","import axios from \"axios\";\nimport { Toast } from \"antd-mobile\";\n\nconst instance = axios.create({\n  baseURL: \"/v1/api/\",\n  timeout: 10000,\n});\n\nconst successHandler = (res) => {\n  if (!res) {\n    Toast.fail(\"请求出错\", 1.5);\n    return;\n  }\n  const {\n    status,\n    data: { ret: success, data = null },\n  } = res;\n\n  if (parseInt(status) === 200) {\n    const handleResBody = {\n      success,\n\n      // 响应数据结构体Object\n      data,\n      // 响应消息String\n    };\n\n    if (!handleResBody.success) {\n      Toast.fail(handleResBody.data, 1.5);\n    }\n    return handleResBody;\n  }\n};\n\nconst errorHandler = (error) => {\n  return Promise.reject(error);\n};\n\n// 响应拦截器\ninstance.interceptors.response.use(successHandler, errorHandler);\n\n// 请求拦截器\ninstance.interceptors.request.use(\n  (config) => {\n    if (config.data && config.method === \"post\") {\n      config.headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n      let ret = \"\";\n      for (let it in config.data) {\n        ret +=\n          encodeURIComponent(it) +\n          \"=\" +\n          encodeURIComponent(config.data[it]) +\n          \"&\";\n      }\n      config.data = ret.substring(0, ret.length - 1);\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\nexport default instance;\n","function isObject(obj) {\n  if (obj === 0) return false;\n  return (\n    obj &&\n    obj.constructor &&\n    obj.constructor.toString().match(/function\\s*([^(]*)/)[1] === \"Object\"\n  );\n}\n\n/**\n *\n * @param {Object} params\n */\nfunction formatQuery(params) {\n  if (!isObject(params)) return \"\";\n\n  let query = \"\";\n  for (const key in params) {\n    query += `${key}=${params[key]}&`;\n  }\n  return query.slice(0, -1);\n}\n\n/**\n * @des 获取query参数\n */\n\nfunction getQuery(key) {\n  let query = window.location.search.slice(1);\n  query = query.split(\"&\");\n\n  if (query.length === 0) return null;\n  const queryObjs = {};\n\n  query.forEach((item) => {\n    const [key, value] = item.split(\"=\");\n    queryObjs[key] = value;\n  });\n\n  if (!key) return queryObjs;\n  return queryObjs[key] || null;\n}\n\nexport default { formatQuery, getQuery };\n","export default function (walletAddress, n = 10) {\n  if (!walletAddress) return \"\";\n  const len = walletAddress.length;\n  return `${walletAddress.substr(0, 10)}...${walletAddress.substr(\n    len - 10,\n    len\n  )}`;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dapp-buy\":\"buy_dapp-buy__SJj5q\",\"dapp-buy__tips\":\"buy_dapp-buy__tips__WszUk\",\"dapp-buy__timeCount\":\"buy_dapp-buy__timeCount__21VOe\",\"dapp-buy__form\":\"buy_dapp-buy__form__1Pl-5\",\"form-item\":\"buy_form-item__3H34H\",\"form-item__label\":\"buy_form-item__label__3WJAR\",\"form-item__input\":\"buy_form-item__input__rxOLz\",\"error-msg\":\"buy_error-msg__3H_xm\",\"show\":\"buy_show__3qlA9\",\"btn-buy\":\"buy_btn-buy__2Oueh\",\"dsb\":\"buy_dsb__3Mxy_\"};","import React, { useState, useEffect, useContext } from \"react\";\nimport cx from \"classnames\";\nimport styles from \"./buy.module.scss\";\nimport { decodeAddress } from \"@demos/address\";\nimport { Toast } from \"antd-mobile\";\nimport { fetchBuyDapp, getDappInfo } from \"../../services/network\";\nimport { formatAddr } from \"../../utils\";\nimport { GlobalContext, PageWrapper, CountDown } from \"../../components\";\n\n// 校验钱包地址\nconst validateAddress = (value) => {\n  if (!value) {\n    return \"合约地址不能为空\";\n  }\n  try {\n    decodeAddress(value);\n  } catch (e) {\n    return \"请填写有效的合约地址\";\n  }\n  return \"\";\n};\n// 校验邮箱\nconst validateMail = (value) => {\n  if (!value) {\n    return \"联系邮箱不能为空\";\n  }\n  const regExpMail = /^\\w+((.\\w+)|(-\\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/;\n  if (!regExpMail.test(value)) {\n    return \"请填写有效的邮箱地址\";\n  }\n  return \"\";\n};\n\n// 倒计时组件\nconst TimeCountDown = ({ data }) => {\n  const { order_time, now_time, state, address } = data;\n  if (state !== 1) return null;\n\n  return (\n    <div className={styles[\"dapp-buy__timeCount\"]}>\n      <h2>\n        <CountDown text=\"剩余申购时间\" time={order_time} now={now_time} />\n      </h2>\n      <p>{`当前申购地址：${formatAddr(address)}`}</p>\n    </div>\n  );\n};\n\n// 表单组件\nconst FormItemInput = (props) => {\n  const { label, placeHolder, type, msg, onChange } = props;\n  return (\n    <div className={styles[\"form-item\"]}>\n      <span className={styles[\"form-item__label\"]}>{label}</span>\n      <div className={styles[\"form-item__input\"]}>\n        <input\n          onChange={(e) => onChange(e, type)}\n          placeholder={placeHolder ?? `请填写您${label}`}\n        />\n      </div>\n      <span\n        className={cx({\n          [styles.show]: msg,\n          [styles[\"error-msg\"]]: 1,\n        })}\n      >\n        {msg}\n      </span>\n    </div>\n  );\n};\n\n// Dapp申购\nfunction BuyDapp(props) {\n  const {\n    history,\n    match: {\n      params: { id: dapp_id },\n    },\n  } = props;\n\n  const globalStore = useContext(GlobalContext);\n  const [formData, setFormData] = useState({\n    gain: \"\",\n    code: \"\",\n    mail: \"\",\n  });\n\n  const [formConfig, setConfig] = useState([\n    {\n      label: \"合约地址\",\n      type: \"gain\",\n      msg: \"\",\n    },\n    {\n      label: \"联系邮箱\",\n      type: \"mail\",\n      msg: \"\",\n    },\n    {\n      label: \"推荐地址\",\n      type: \"code\",\n      placeHolder: \"推荐地址（只能填写矿池地址）\",\n    },\n  ]);\n\n  const [dappInfo, setDappinfo] = useState({});\n  useEffect(() => {\n    const fetch = async () => {\n      const { ret, data = {}, time = 0 } = await getDappInfo(dapp_id);\n      console.log(\"data\", data, \"time\", time);\n      if (ret) setDappinfo({ ...data, now_time: time });\n    };\n    fetch();\n  }, []);\n\n  const validate = () => {\n    const { gain, mail } = formData;\n    let errMsg = \"\";\n    formConfig.forEach((item) => {\n      if (item.msg) {\n        errMsg += item.msg;\n      }\n    });\n\n    if (errMsg.length == 0) {\n      const _formConfig = formConfig.map((item) => {\n        if (item.type !== \"code\") {\n          item.msg = formData[item.type] ? \"\" : `${item.label}不能为空`;\n        }\n        return item;\n      });\n      setConfig(_formConfig);\n    }\n\n    return gain && mail && errMsg.length == 0 ? true : false;\n  };\n\n  const submitHandler = async () => {\n    if (BuyDapp.lock) return;\n    BuyDapp.lock = true;\n\n    if (!validate()) {\n      BuyDapp.lock = null;\n      return;\n    }\n\n    const { gain, code, mail } = formData;\n    // 生成待广播哈希\n    const rawtx = await window.demos\n      .contractRaw(\"send\", globalStore.contract, [\n        { type: \"address\", value: globalStore.target_address },\n        { type: \"uint256\", value: dappInfo.price },\n      ])\n      .catch((e) => {\n        BuyDapp.lock = null;\n      });\n\n    if (!rawtx) {\n      BuyDapp.lock = null;\n      return;\n    }\n\n    const params = {\n      rawtx,\n      gain,\n      code,\n      mail,\n      id: parseFloat(dapp_id),\n      addr: globalStore.wallet_address,\n    };\n    // console.log(\"params\", params);\n\n    Toast.loading();\n    const res = await fetchBuyDapp(params).catch((error) => {\n      console.log(error);\n      BuyDapp.lock = null;\n    });\n\n    Toast.hide();\n    BuyDapp.lock = null;\n\n    if (res?.ret) {\n      Toast.success(\"申购dapp成功\", 2.5, () => {\n        history.push(\"/history\");\n      });\n    } else {\n      Toast.fail(res?.data || \"请求错误！\", 2);\n    }\n  };\n\n  const onchangeHandler = (event, type) => {\n    const value = event.target.value;\n    const _formConfig = formConfig.slice();\n    const index = formConfig.findIndex((item) => type === item.type);\n\n    switch (type) {\n      case \"gain\":\n        _formConfig[index].msg = validateAddress(value);\n        break;\n      case \"mail\":\n        _formConfig[index].msg = validateMail(value);\n        break;\n    }\n\n    if (type !== \"code\") {\n      setConfig(_formConfig);\n    }\n    setFormData({ ...formData, [type]: value });\n  };\n\n  const { order_time, now_time, state } = dappInfo;\n\n  return (\n    <PageWrapper title=\"Dapp申购\" {...props}>\n      <div\n        className={cx({\n          page: 1,\n          [styles[\"dapp-buy\"]]: 1,\n        })}\n      >\n        <div className={styles[\"dapp-buy__tips\"]}>\n          <h3>申购说明</h3>\n          <p>\n            1、所有矿池可享有申购优先权力，申购倒计时结束时将优先选择矿池作为dapp所有人。\n          </p>\n          <p>2、申购倒计时于首个申购产生后24个小时结束。</p>\n        </div>\n        <TimeCountDown\n          data={{\n            order_time,\n            now_time,\n            state,\n            address: globalStore.wallet_address,\n          }}\n        />\n        <div className={styles[\"dapp-buy__form\"]}>\n          {formConfig.map((item, i) => (\n            <FormItemInput\n              {...item}\n              key={item.type}\n              onChange={onchangeHandler}\n            />\n          ))}\n        </div>\n        <button className={styles[\"btn-buy\"]} onClick={submitHandler}>\n          购买\n        </button>\n      </div>\n    </PageWrapper>\n  );\n}\n\nexport default BuyDapp;\n"],"sourceRoot":""}