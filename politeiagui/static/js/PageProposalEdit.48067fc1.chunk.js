(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{105:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=o(a(0)),l=o(a(25));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var c=function(e){function t(){var e,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=Array(r),l=0;l<r;l++)i[l]=arguments[l];return a=n=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.fileInput=null,n.setFileInput=function(e){n.fileInput=e},n.clickInput=function(){var e=n.fileInput;e.value="",e.click()},n.handleFiles=function(e){n.props.base64?n.convertFilesToBase64(e.target.files):n.props.handleFiles(e.target.files)},n.convertFilesToBase64=function(e){var t=e;if(n.props.multipleFiles){var a,r;!function(){var e={base64:[],fileList:t},i=function(){var r=new FileReader,i=t[a];r.onloadend=function(a){e.base64.push(r.result),e.base64.length===t.length&&n.props.handleFiles(e)},r.readAsDataURL(i)};for(a=0,r=t.length;a<r;a++)i()}()}else{var i={base64:"",fileList:t},l=t[0],o=new FileReader;o.onloadend=function(e){i.base64=o.result,n.props.handleFiles(i)},o.readAsDataURL(l)}},s(n,a)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default.Component),r(t,[{key:"render",value:function(){var e={};return this.props.elementId&&(e.id=this.props.elementId),i.default.createElement("div",{className:"react-file-reader"},i.default.createElement("input",n({type:"file",onChange:this.handleFiles,accept:Array.isArray(this.props.fileTypes)?this.props.fileTypes.join(","):this.props.fileTypes,className:"react-file-reader-input",ref:this.setFileInput,multiple:this.props.multipleFiles,style:{width:"0px",opacity:"0",position:"fixed"},disabled:this.props.disabled},e)),i.default.createElement("div",{className:"react-file-reader-button",onClick:this.clickInput},this.props.children))}}]),t}();t.default=c,c.defaultProps={fileTypes:"image/*",multipleFiles:!1,base64:!1,disabled:!1},c.propTypes={multipleFiles:l.default.bool,handleFiles:l.default.func.isRequired,fileTypes:l.default.oneOfType([l.default.string,l.default.array]),base64:l.default.bool,children:l.default.element.isRequired,disabled:l.default.bool,elementId:l.default.string}},1271:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(75),l=a(29),o=a(20),s=a(489),c=a(19),u=a(45),p={},f={onEditProposal:c.s};var d=a(1275),m=a(160),b=a(118),h=a(292),v=a(291),y=a(293),g=a(332),E=Object(d.a)(function(e){var t,a=e.match,n=Object(s.a)({match:a}),i=n.proposal,c=n.loading,d=Object(u.b)(t,p,f).onEditProposal,E=Object(b.a)().isPaid,O=Object(h.a)(),j=Object(l.a)(O,2)[1],F=i?{token:a.params.token,name:i.name,description:Object(m.a)(i.files),files:i.files.filter(function(e){return"index.md"!==e.name})}:{};return i&&!c?r.a.createElement(o.c,{paddingSize:"small"},r.a.createElement(v.a,null,!E&&r.a.createElement(o.p,{kind:"error"},"You must pay the paywall to create a proposal"),!!j&&r.a.createElement(y.a,null)),r.a.createElement(g.a,{initialValues:F,onSubmit:d})):null});t.default=function(){return r.a.createElement(i.a,{topBannerHeight:90},function(e){var t=e.TopBanner,a=e.PageDetails,n=e.Sidebar,i=e.Main;return r.a.createElement(r.a.Fragment,null,r.a.createElement(t,null,r.a.createElement(a,{headerClassName:"no-margin-top",title:"Edit Proposal"})),r.a.createElement(n,null),r.a.createElement(i,null,r.a.createElement(E,null)))})}},326:function(e,t,a){e.exports={attachFileButton:"AttachFileButton_attachFileButton__cuFxx"}},327:function(e,t,a){e.exports=a.p+"static/media/attach-file.a5d32ac1.svg"},332:function(e,t,a){"use strict";var n=a(39),r=a.n(n),i=a(40),l=a(0),o=a.n(l),s=a(1275),c=a(133),u=a(20),p=a(220),f=a(336),d=a(105),m=a.n(d);var b=function(e){var t=e.value,a=e.onChange,n=e.children,r=e.validMimeTypes;return o.a.createElement(m.a,{base64:!0,multipleFiles:!0,fileTypes:r,handleFiles:function(e){var n=function(e){var t=e.base64,a=e.fileList;return Array.from(a).map(function(e,a){var n=e.name,r=e.size,i=e.type;return{name:n,mime:n.includes(".txt")?"".concat(i,"; charset=utf-8"):i,size:r,payload:t[a].split("base64,").pop()}})}(e),r=t?n.concat(t):n;a(r)}},n)},h=a(24),v=a(326),y=a.n(v),g=a(327),E=a.n(g),O=function(e){var t=e.className,a=Object(h.a)(e,["className"]);return o.a.createElement(u.b,Object.assign({className:Object(u.E)(y.a.attachFileButton,t)},a),o.a.createElement("img",{alt:"Attach",src:E.a}))},j=a(29),F=a(121),w=a(44),S=a(71),k=a(88),_=function(e){var t,a=e.proposalnamesupportedchars,n=e.maxproposalnamelength,r=e.minproposalnamelength;return S.object().shape({name:(t=S.string().min(r,Object(k.b)("name",r)).max(n,Object(k.a)("name",n))).matches.apply(t,Object(w.a)(Object(k.c)("Name",a))).required("Required"),description:S.string().required("Required")})};var x=Object(s.a)(function(e){var t=e.initialValues,a=e.onSubmit,n=e.history,s=e.disableSubmit,d=function(){var e=Object(F.a)().policy,t=Object(l.useState)(e?_(e):null),a=Object(j.a)(t,2),n=a[0],r=a[1];return Object(l.useEffect)(function(){e&&!n&&r(_(e))},[e,n]),{validationSchema:n,policy:e}}().validationSchema;function m(){return(m=Object(i.a)(r.a.mark(function e(t,i){var l,o,s,c;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=i.resetForm,o=i.setSubmitting,s=i.setFieldError,e.prev=1,e.next=4,a(t);case 4:c=e.sent,o(!1),n.push("/proposal/".concat(c)),l(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),o(!1),s("global",e.t0);case 14:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}return o.a.createElement(c.a,{initialValues:t||{name:"",description:"",files:[]},loading:!d,validationSchema:d,onSubmit:function(e,t){return m.apply(this,arguments)}},function(e){var t=e.values,a=e.handleChange,n=e.handleBlur,r=e.handleSubmit,i=e.isSubmitting,l=e.touched,c=e.setFieldValue,d=e.errors,m=e.isValid;return o.a.createElement("form",{onSubmit:r},d&&d.global&&o.a.createElement(u.p,{kind:"error"},d.global.toString()),o.a.createElement(u.a,{placeholder:"Proposal name",name:"name",value:t.name,onChange:a,onBlur:n,error:l.name&&d.name}),o.a.createElement(f.a,{name:"description",className:"margin-top-s",value:t.description,onChange:function(e){c("description",e)},onBlur:n,placeholder:"Write your proposal",filesInput:o.a.createElement(b,{value:t.files,onChange:function(e){c("files",e)}},o.a.createElement(O,{type:"button"}))}),o.a.createElement(p.a,{justify:"right",topMarginSize:"s"},o.a.createElement(u.b,{kind:"secondary"},"Save as draft"),o.a.createElement(u.b,{type:"submit",kind:!m&&s?"disabled":"primary",loading:i},"Submit")))})});a.d(t,"a",function(){return x})}}]);
//# sourceMappingURL=PageProposalEdit.48067fc1.chunk.js.map